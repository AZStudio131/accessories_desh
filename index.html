<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kinetic Admin | Ultimate Control</title>
    <style>
        :root { --accent: #e69d45; --danger: #e74c3c; --success: #27ae60; --dark: #1a1a1a; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; }
        
        /* LOGIN OVERLAY */
        #login-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:var(--dark); display:flex; align-items:center; justify-content:center; z-index:999; }
        .login-box { background:white; padding:40px; border-radius:15px; width:350px; text-align:center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .login-box input { width:100%; padding:12px; margin:10px 0; border:1px solid #ddd; border-radius:8px; box-sizing: border-box; }

        /* DASHBOARD UI */
        #dashboard-ui { display:none; padding:25px; }
        .container { max-width: 1500px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid var(--accent); padding-bottom: 15px; margin-bottom: 20px; }
        .bulk-bar { display:none; background: #fff5e6; padding: 15px; border-radius: 8px; border: 1px solid var(--accent); margin-bottom: 20px; }

        table { width: 100%; border-collapse: collapse; }
        th { background: #222; color: white; padding: 12px; text-align: left; font-size: 12px; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 13px; }
        tr:hover { background: #fafafa; }
        .selected-row { background-color: #fff9f0 !important; }

        .btn { border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-refresh { background: var(--accent); color: white; }
        .btn-csv { background: var(--success); color: white; margin-right: 10px; }
        .btn-del { background: var(--danger); color: white; }
        
        .status-pill { padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .pending { background: #ffeaa7; color: #d35400; }
        .completed { background: #55efc4; color: #00b894; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h2>KINETIC SECURE</h2>
            <input type="text" id="user" placeholder="Username">
            <input type="password" id="pass" placeholder="Password">
            <button class="btn btn-refresh" style="width:100%; margin-top:10px;" onclick="attemptLogin()">LOGIN</button>
        </div>
    </div>

    <div id="dashboard-ui">
        <div class="container">
            <div class="header">
                <h1>Order Control Panel</h1>
                <div>
                    <button class="btn btn-csv" onclick="downloadCSV()">üì• EXPORT CSV</button>
                    <button class="btn btn-refresh" onclick="fetchOrders()">üîÑ REFRESH</button>
                    <button class="btn" style="background:#555; color:white; margin-left:10px;" onclick="location.reload()">LOGOUT</button>
                </div>
            </div>

            <div id="bulkBar" class="bulk-bar">
                <span id="selectedCount" style="font-weight:bold;">0 items selected</span>
                <button class="btn btn-del" style="margin-left:20px;" onclick="deleteSelected()">üóëÔ∏è DELETE SELECTED</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAll" onclick="toggleAll(this)"></th>
                        <th>Date</th>
                        <th>Product</th>
                        <th>Customer / Email</th>
                        <th>Address / Postal</th>
                        <th>Phone</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="orderList"></tbody>
            </table>
        </div>
    </div>

<script>
    const CLOUD_URL = "https://script.google.com/macros/s/AKfycbzxh2sBt9G9j4dQKRP-s2g48dpjlWz2osC3vmUD0P2asvv7r0vs6pTmCUWd6hyU91kI/exec";
    let ordersData = [];

    function attemptLogin() {
        if(document.getElementById('user').value === "admin" && document.getElementById('pass').value === "kinetic2026") {
            document.getElementById('login-overlay').style.display = "none";
            document.getElementById('dashboard-ui').style.display = "block";
            fetchOrders();
        } else { alert("Access Denied"); }
    }

    async function fetchOrders() {
        const list = document.getElementById('orderList');
        list.innerHTML = "<tr><td colspan='7' style='text-align:center; padding:30px;'>Synchronizing Cloud Data...</td></tr>";
        try {
            const res = await fetch(`${CLOUD_URL}?t=${Date.now()}`);
            ordersData = await res.json();
            list.innerHTML = "";
            ordersData.slice().reverse().forEach(o => {
                list.innerHTML += `
                    <tr id="row-${o.rowId}">
                        <td><input type="checkbox" class="order-check" value="${o.rowId}" onclick="updateUI()"></td>
                        <td>${new Date(o.date).toLocaleDateString()}</td>
                        <td><strong>${o.item}</strong><br><small>${o.price}</small></td>
                        <td>${o.name}<br><small style="color:#888;">${o.email}</small></td>
                        <td>${o.address}<br><strong>${o.zip}</strong></td>
                        <td>${o.phone}</td>
                        <td><span class="status-pill ${o.status === 'COMPLETED' ? 'completed' : 'pending'}" onclick="toggleStatus(this)">${o.status || 'PENDING'}</span></td>
                    </tr>`;
            });
        } catch (e) { list.innerHTML = "Error loading data."; }
    }

    function toggleAll(master) {
        document.querySelectorAll('.order-check').forEach(cb => cb.checked = master.checked);
        updateUI();
    }

    function updateUI() {
        const checked = document.querySelectorAll('.order-check:checked');
        document.getElementById('bulkBar').style.display = checked.length > 0 ? "block" : "none";
        document.getElementById('selectedCount').innerText = `${checked.length} items selected`;
        document.querySelectorAll('.order-check').forEach(cb => {
            cb.closest('tr').className = cb.checked ? "selected-row" : "";
        });
    }

    async function deleteSelected() {
        const selected = Array.from(document.querySelectorAll('.order-check:checked')).map(cb => cb.value);
        if(!confirm(`Delete ${selected.length} orders forever?`)) return;
        try {
            await fetch(`${CLOUD_URL}?action=deleteMulti&rows=${selected.join(',')}`);
            alert("Database Updated Successfully!");
            fetchOrders();
        } catch (e) { alert("Action failed."); }
    }

    function toggleStatus(btn) {
        btn.innerText = btn.innerText === "PENDING" ? "COMPLETED" : "PENDING";
        btn.className = `status-pill ${btn.innerText.toLowerCase()}`;
    }

    function downloadCSV() {
        let csv = "Date,Item,Price,Name,Email,Phone,Address,Zip,Status\n";
        ordersData.forEach(o => {
            csv += `"${o.date}","${o.item}","${o.price}","${o.name}","${o.email}","${o.phone}","${o.address}","${o.zip}","${o.status}"\n`;
        });
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `Kinetic_Orders_${new Date().toISOString().slice(0,10)}.csv`;
        a.click();
    }
</script>
</body>
</html>
